<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–®–∏—Ñ—Ä –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äì –†—É—Å—Å–∫–∏–π</title>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8150869065682337"
     crossorigin="anonymous"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="caeser.html" class="nav-link" id="caesar-link">Caesar Cipher</a>
      <a href="substitution.html" class="nav-link" id="substitution-link">Substitution Cipher</a>
    </div>
  </nav>
  
  <h2>–®–∏—Ñ—Ä –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Äì –†—É—Å—Å–∫–∏–π</h2>

  <div class="language-switcher">
    <label for="languageSelect">üåê Language / –Ø–∑—ã–∫:</label>
    <select id="languageSelect">
      <option value="substitution.html">English</option>
      <option value="substitution-hebrew.html">◊¢◊ë◊®◊ô◊™</option>
      <option value="substitution-russian.html" selected>–†—É—Å—Å–∫–∏–π</option>
    </select>
  </div>

  <label for="inputText">–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç:</label>
  <textarea id="inputText" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>

  <label>–ö–ª—é—á —à–∏—Ñ—Ä–∞ (–±—É–∫–≤–∞ ‚Üí –±—É–∫–≤–∞):</label>
    <div class="grid-rows">
      <div class="grid-row" id="subGrid1"></div>
      <div class="grid-row" id="subGrid2"></div>
      <div class="grid-row" id="subGrid3"></div>
    </div>


  <div class="sub-controls">
    <div class="caesar-group">
      <label for="caesarShift">–°–¥–≤–∏–≥:</label>
      <input type="number" id="caesarShift" min="0" max="32" value="3" />
      <button id="applyCaesar">–¶–µ–∑–∞—Ä—å</button>
    </div>
    <div class="caesar-group">
      <label for="reverseShift">–°–¥–≤–∏–≥:</label>
      <input type="number" id="reverseShift" min="0" max="32" value="0" />
      <button id="applyReverse">–û–±—Ä–∞—Ç–Ω—ã–π –∞–ª—Ñ–∞–≤–∏—Ç</button>
    </div>
    <button id="randomizeBtn" class="side-button">üé≤ –°–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á</button>
  </div>

  <label for="outputText">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</label>
  <textarea id="outputText" rows="4" readonly></textarea>
	<div class="button-row">
      <button onclick="goToDecoder()" class="side-btn">üîç –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏</button>
	  <!--<button id="goToTools" class="side-btn">Substitution letter page Tools</button>-->
	</div>
  <script>
    const letters = '–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø'.split('');
    const inputText = document.getElementById('inputText');
    const outputText = document.getElementById('outputText');
    const inputs = {};

    const subGrid1 = document.getElementById('subGrid1');
    const subGrid2 = document.getElementById('subGrid2');
    const subGrid3 = document.getElementById('subGrid3');

    letters.forEach((letter, index) => {
      const cell = document.createElement('div');
      cell.className = 'sub-cell';

      const label = document.createElement('label');
      label.textContent = letter;

      const input = document.createElement('input');
      input.maxLength = 1;

      inputs[letter] = input;
      cell.appendChild(label);
      cell.appendChild(input);

      if (index < 11) {
        subGrid1.appendChild(cell);
      } else if (index < 22) {
        subGrid2.appendChild(cell);
      } else {
        subGrid3.appendChild(cell);
      }
    });


    function generateRandomKey() {
      const shuffled = [...letters];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function fillRandomKey() {
      const key = generateRandomKey();
      for (let i = 0; i < letters.length; i++) {
        inputs[letters[i]].value = key[i];
      }
      updateOutput();
    }

    function getSubstitutionMap() {
      const map = {};
      const used = {};
      for (const letter of letters) {
        const val = inputs[letter].value.toUpperCase();
        inputs[letter].classList.remove('duplicate');

        if (!val || val.length !== 1 || !letters.includes(val)) {
          return null;
        }

        map[letter] = val;
        if (!used[val]) used[val] = [];
        used[val].push(letter);
      }

      for (const val in used) {
        if (used[val].length > 1) {
          for (const letter of used[val]) {
            inputs[letter].classList.add('duplicate');
          }
          return null;
        }
      }

      return map;
    }

    function encrypt(text, map) {
      return text.split('').map(ch => map[ch.toUpperCase()] || ch).join('');
    }

    function updateOutput() {
      const map = getSubstitutionMap();
      const text = inputText.value;

      if (map) {
        outputText.value = encrypt(text, map);
      } else {
        outputText.value = '[–û—à–∏–±–∫–∞: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è]';
      }
    }

    function applyCaesarShift() {
      const shift = parseInt(document.getElementById('caesarShift').value, 10) || 0;
      for (let i = 0; i < letters.length; i++) {
        const original = letters[i];
        const shifted = letters[(i + shift) % letters.length];
        inputs[original].value = shifted;
      }
      updateOutput();
    }

    function applyReverseShift() {
      const shift = parseInt(document.getElementById('reverseShift').value, 10) || 0;
      const reversed = [...letters].reverse();
      const shifted = reversed.slice(shift).concat(reversed.slice(0, shift));
      for (let i = 0; i < letters.length; i++) {
        const original = letters[i];
        inputs[original].value = shifted[i];
      }
      updateOutput();
    }

    inputText.addEventListener('input', updateOutput);
    document.getElementById('randomizeBtn').addEventListener('click', fillRandomKey);
    document.getElementById('applyCaesar').addEventListener('click', applyCaesarShift);
    document.getElementById('applyReverse').addEventListener('click', applyReverseShift);
    for (const input of Object.values(inputs)) {
      input.addEventListener('input', updateOutput);
    }

    fillRandomKey();

    // Language switcher
    const languageSelect = document.getElementById("languageSelect");
    languageSelect.addEventListener("change", () => {
      window.location.href = languageSelect.value;
    });
    function goToDecoder() {
      const output = document.getElementById("outputText").value.trim();
      if (!output) return;
      const url = `decode-helper-russian.html?text=${encodeURIComponent(output)}`;
      window.location.href = url;
    }

  </script>

</body>
</html>
